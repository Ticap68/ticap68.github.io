<!DOCTYPE html>
<html>
<meta charset="utf-8">
<!-- <link rel="stylesheet" href="style.css">  -->

<head>
  <title>Altitude - Finesse</title>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    .leaflet-container {
      height: 600px;
      width: 1000px;
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>

<body>
  <div id="map" style="width: 1000px; height: 600px;"></div>
  <p>
    ALTITUDE A : <span id="altitude-a"></span> <br>
    ALTITUDE B : <span id="altitude-b"></span> <br>
    Distance A-B : <span id="latlng-a"></span> <br>
    <button type="button" id="refresh-button">Actualiser l'altitude</button>
  </p>
  <form id="calculator-form">
    <label for="vitesse">Vitesse :</label>
    <input type="number" id="vitesse" min="0" step="0.1">
    <br>
    <label for="tauxChute">Taux de chute :</label>
    <input type="number" id="tauxChute" min="0" step="0.1">
    <br>
    <button type="submit">Calculer</button>
  </form>
  <script>
    const map = L.map('map').setView([48.043, 7.156], 10);
    const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    let markerA = null;
    let markerB = null;
    map.on('click', function (e) {
      if (markerA == null) {
        markerA = L.marker(e.latlng, { draggable: true });
        markerA.addTo(map);
        getAltitude(markerA, 'altitude-a');
      } else if (markerB == null) {
        markerB = L.marker(e.latlng, { draggable: true });
        markerB.addTo(map);
        getAltitude(markerB, 'altitude-b');
      }
    });
    function getAltitude(marker, elementId) {
      var config = {
        method: 'get',
        url: 'https://api.open-elevation.com/api/v1/lookup?locations=' + marker.getLatLng().lat + ',' + marker.getLatLng().lng,
        headers: {}
      };
      axios(config)
        .then(function (response) {
          document.getElementById(elementId).innerHTML = response.data.results[0].elevation.toFixed(1) + ' m';
        })
        .catch(function (error) {
          console.log(error);
        });
    }
    document.getElementById('refresh-button').addEventListener('click', function () {
      // Appeler la fonction getAltitude pour actualiser l'altitude
      getAltitude(markerA, 'altitude-a');
      getAltitude(markerB, 'altitude-b');
    });
    function updateDistance() {
      const distance = markerA.getLatLng().distanceTo(markerB.getLatLng());
      document.getElementById('latlng-a').innerHTML = distance + ' mètres';
      document.getElementById('latlng-b').innerHTML = distance + ' mètres';
    }

    // Appeler la fonction updateDistance lorsque l'un des marqueurs est déplacé
    if (markerA != null && markerB != null) {
      markerA.on('drag', updateDistance);
      markerB.on('drag', updateDistance);
      let distance = markerA.getLatLng().distanceTo(markerB.getLatLng()).toFixed(1);
      document.getElementById('latlng-a').innerHTML = distance + ' m';
    }

  </script>
</body>

</html>